<%= render 'layouts/customer_header' %>
<div class="col-lg-9">
	<h1><%= @group.name%>   マップ一覧</h1>
  <script async defer
                src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyAMaUX8y-y1Kk4TzBmDmjBIylax5DvqfaE&callback=initMap">
  </script>
  <div id="map"></div>
  <style type="text/css">
    #map { height: 300px;
           width: 70%;}
  </style>
  <script>
      function initMap() {

        //初期表示位置
        var latlng = new google.maps.LatLng({lat: <%= @center_place.latitude %>, lng: <%= @center_place.longitude %>});

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 9,
            center: latlng
        });
        var transitLayer = new google.maps.TransitLayer();
        transitLayer.setMap(map);

        //複数マーカー ここから
        <% Place.where(group_id: @group.id).each do |place|%>
        (function(){
          var contentString = "住所：<%= place.address %>";
          var infowindow = new google.maps.InfoWindow({
              content: contentString
          });

          var marker = new google.maps.Marker({
              position:{lat: <%= place.latitude %>, lng: <%= place.longitude %>},
              map: map,
              title: contentString
          });

          marker.addListener('click', function() {
            infowindow.open(map, marker, contentString);
          });
         })();
        <% end %>
        //複数マーカー ここまで
    }
  </script>
	<table>
		<tr>
			<th>プロフィール画像</th>
			<th>ニックネーム</th>
			<th>場所</th>
		</tr>
		<tr>
			<% Place.where(group_id: @group.id).each do |place|%>
				<td><%= attachment_image_tag place.customer, :image, :fill, 60, 60, fallback: "", size:'100x100'%></td>
				<td><%= place.customer.nick_name%></td>
				<td><%= place.address%></td>
		</tr>
			<% end %>
	</table>
</div>