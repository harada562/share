<%= render 'layouts/customer_header'%>
<%= render 'layouts/customer_profile'%>
<div class="row place_show">
<div class="col-lg-4">
	<h1>スポット詳細</h1>
	<!-- 登録者が本人の場合表示しない -->
	<% unless @place.customer_id == current_customer.id%>
		<div>
			<h3>登録者名</h3>
			<%= @place.customer.nick_name%>
		</div>
	<% end %>

	<div>
	<h3>ジャンル</h3>
		<% if @place.genre.blank? %>
			<p>ジャンルなし</p>
		<% else %>
			<p><%= @place.genre.name%></p>
		<% end %>
	</div>

	<div>
		<h3>場所名</h3>
			<p><%= @place.place_name%></p>
		<h3>住所</h3>
			<p><%= @place.address%></p>
	</div>
	<div>
		<h3>場所URL</h3>
		<!-- 登録者本人の場合の表示 -->
		<% if @place.customer_id == current_customer.id %>
			<% if @place.place_url.blank? %>
				<%= link_to "お店のURLを登録しよう！！", edit_public_place_path(@place.id),class: "btn btn-info"%>
			<% else %>
				<p><%= @place.place_url%></p>
			<% end %>
		<% else %>
		<!-- 登録者以外の表示 -->
			<% if @place.place_url.blank? %>
				<p>????</p>
			<% else %>
				<%= @place.place_url%>
			<% end %>
		<% end %>
	</div>

	<div>
		<h3>お店の電話番号</h3>
	<!-- 登録者本人の場合 -->
	<% if @place.customer_id == current_customer.id %>
		<% if @place.number.blank? %>
			<%= link_to "電話番号を登録しよう！！", edit_public_place_path(@place.id),class: "btn btn-info"%>
		<% else %>
			<%= @place.number%>
		<% end %>
	<% else %>
	<!-- 登録者以外の表示 -->
		<% if @place.number.blank? %>
			<p>????</p>
		<% else %>
			<%= @place.number%>
		<% end %>
	<% end %>
	</div>

	<div>
		<h3>平均予算</h3>
		<% if @place.customer_id == current_customer.id %>
			<% if @place.budget.nil? %>
				<%= link_to "平均予算を登録しよう！！", edit_public_place_path(@place.id),class: "btn btn-info"%>
			<% else %>
				<%= @place.budget%>円
			<% end %>
		<% else %>
			<% if @place.budget.nil? %>
				<p>????円</p>
			<% else %>
				<%= @place.budget%>円
			<% end %>
		<% end %>
	</div>
	<div>
		<h3>メモ</h3>
		<% if @place.customer_id == current_customer.id %>
			<% if @place.detail.nil? %>
				<%= link_to "メモ", edit_public_place_path(@place.id),class: "btn btn-info"%>
			<% else %>
				<%= @place.detail%>
			<% end %>
		<% else %>
			<% unless @place.detail.nil? %>
				<%= @place.detail%>
			<% end %>
		<% end %>
	</div>

</div>
	<div class="col-lg-2">
		<% if @place.customer_id == current_customer.id %>
			<div class="place_show__link"><%= link_to "編集する", edit_public_place_path(@place.id),class: "btn btn-success" %></div>
			<div class="place_show__link"><%= link_to "削除", public_place_path(@place.id), method: :delete , class: "btn btn-danger"%></div>
		<% end %>
		<div class="place_show__like">
			<div id="likes_buttons">
             <%= render partial: 'public/likes/like', locals: { place: @place } %>
          	</div>
		</div>
	</div>
<div class="col-lg-6">
<script async defer
                src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap">
  </script>

<% if @place.latitude.nil?%>
	<h1>入力された住所は存在しません</h1>
<% else %>
<style type="text/css">
  #map { height: 700px;
         width: 100%;}
</style>

<!-- #mapの表示 -->
<div id="map"></div>
<script type="text/javascript">
  function initMap() {
// #latitude,longitudeから位置を特定
    var test ={lat: <%= @place.latitude %>, lng: <%= @place.longitude %>};
    var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 15,
              center: test
              });
    var transitLayer = new google.maps.TransitLayer();
    transitLayer.setMap(map);

    var contentString = '住所：<%= @place.address %>';
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });

 // #Map上の指定した位置にピンを挿して表示する
    var marker = new google.maps.Marker({
                  position:test,
                  map: map,
                  title: contentString
                 });

     marker.addListener('click', function() {
       infowindow.open(map, marker);
     });
  }
</script>
<% end %>
</div>
</div>