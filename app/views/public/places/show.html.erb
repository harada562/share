<%= render 'layouts/customer_header'%>
<div class="col-lg-3">
	<h1>スポット詳細</h1>
	<div>
		<h2>登録者名</h2>
		<%= @place.customer.nick_name%>
	</div>
	<div>
	<h2>ジャンル</h2>
		<% if @place.genre.nil? %>
			<p>ジャンルなし</p>
		<% else %>
			<p><%= @place.genre.name%></p>
		<% end %>
	</div>
	<div>
		<h2>場所名</h2>
			<p><%= @place.place_name%></p>
		<h2>住所</h2>
			<p><%= @place.address%></p>
	</div>
	<div>
		<h2>場所URL</h2>
	<% if @place.customer_id == current_customer.id %>
		<% if @place.place_url.nil? %>
			<%= link_to "お店のURLを登録しよう！！", edit_public_place_path(@place.id)%>
		<% else %>
			<p><%= @place.place_url%></p>
		<% end %>
	<% else %>
		<% if @place.place_url.nil? %>
			<p>????</p>
		<% else %>
			<%= @place.place_url%>
		<% end %>
	<% end %>
	</div>
	<div>
		<h2>お店の電話番号</h2>
	<% if @place.customer_id == current_customer.id %>
		<% if @place.number.blank? %>
			<%= link_to "電話番号を登録しよう！！", edit_public_place_path(@place.id)%>
		<% else %>
			<%= @place.number%>
		<% end %>
	<% else %>
		<% if @place.number.blank? %>
			<p>????</p>
		<% else %>
			<%= @place.number%>
		<% end %>
	<% end %>
	</div>
	<div>
		<h2>平均予算</h2>
		<% if @place.budget.blank? %>
			<p>???円</p>
		<% else %>
			<%= @place.budget%>円
		<% end %>
	</div>
	<% unless current_customer.email == "guest@guest" %>
	<div>
		<% if current_customer.already_liked?(@place) %>
		  <%= link_to public_place_like_path(@place), method: :delete do %>
		  	<i class="fas fa-heart"></i>
		  <% end %>
		<% else %>
		  <%= link_to public_place_likes_path(@place), method: :post do %>
		  	<i class="far fa-heart"></i>
		  <% end %>
		<% end %>
	</div>
	<% end %>
	<% if @place.customer_id == current_customer.id %>
		<div><%= link_to "編集する", edit_public_place_path(@place.id),class: "btn btn-success" %></div>
		<div><%= link_to "削除", public_place_path(@place.id), method: :delete , class: "btn btn-danger"%></div>
	<% end %>
</div>
<div class="col-lg-6">
<!-- #以下の記述の中にあるYOUR_API_KEYには取得したご自身のAPIキーを記述してください -->
<script async defer
                src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap">
  </script>

<% if @place.latitude.nil?%>
	<h1>入力された住所は存在しません</h1>
<% else %>
<style type="text/css">
  #map { height: 600px;
         width: 100%;}
</style>

<!-- #mapの表示 -->
<div id="map"></div>
<script type="text/javascript">
  function initMap() {
// #latitude,longitudeから位置を特定
    var test ={lat: <%= @place.latitude %>, lng: <%= @place.longitude %>};
    var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 15,
              center: test
              });
    var transitLayer = new google.maps.TransitLayer();
    transitLayer.setMap(map);

    var contentString = '住所：<%= @place.address %>';
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });

 // #Map上の指定した位置にピンを挿して表示する
    var marker = new google.maps.Marker({
                  position:test,
                  map: map,
                  title: contentString
                 });

     marker.addListener('click', function() {
       infowindow.open(map, marker);
     });
  }
</script>
<% end %>
</div>